import sqlite3
from it import *

bdd = sqlite3.connect("bdd_user.db")
curseur = bdd.cursor()

requete = """
DROP TABLE IF EXISTS noeud; 
"""
curseur.execute(requete)


requete = """
DROP TABLE IF EXISTS arc; 
"""
curseur.execute(requete)




requete = """
DROP TABLE IF EXISTS capture; 
"""
curseur.execute(requete)
requete = """
CREATE TABLE capture (
id_user STRING REFERENCES user (id),
id_noeud INTEGER REFERENCES noeud (nom),
PRIMARY KEY (id_user, id_noeud));
"""
curseur.execute(requete)



def insert_noeud(noeud):
    """param: noeud nom du lien STR"""
    requete = """
    INSERT INTO noeud
    VALUES (
    ?
    );
    """
    curseur.execute(requete, (noeud,))



def insert_capture(noeud, id_user):
    """param: noeud nom du lien STR, id_user STR"""
    requete = """
    INSERT INTO capture
    VALUES (
    ?,
    ?
    );
    """
    curseur.execute(requete, (id_user, noeud))



def insert_arc(noeud_pere, noeud_fils):
    """param: les noeuds sont STR"""
    requete = """
    INSERT INTO arc
    VALUES (
    ?,
    ?
    );
    """
    curseur.execute(requete, (noeud_pere, noeud_fils,))


def noeud_existe(noeud):
    """param: noeud STR"""
    requete="""
    SELECT *
    FROM noeud
    WHERE nom = ?;
    """
    curseur.execute(requete, (noeud,))
    a = curseur.fetchall()
    if a == []:
        return False
    else:
        return True


def enregistrer_noeud(noeud_obj, id_user ):
    #le param "noeud" est un type wikipédia
    insert_noeud(noeud_obj.val)
    [insert_noeud(noeud_voisin.val) for noeud_voisin in noeud_obj.voisins]
    [insert_arc(noeud_obj.val, voisin.val) for voisin in noeud_obj.voisins]
    insert_capture(noeud_obj.val, id_user)



def chercher_voisins(nom_pere):
    requete = """
    SELECT *
    FROM arc
    WHERE nom_pere = ?;
    """
    curseur.execute(requete, (nom_pere,))
    a = curseur.fetchall()
    return a




def chercher_capture(id_user, nom_noeud):
    voisins = chercher_voisins(nom_noeud)
    [chercher_voisins(nom_noeud)]

    noeud_capture = noeud(nom_noeud)







# {'Catégorie:Histoire': [Histoire (id: ??, ns: 0), Catégorie:Histoire par groupe ethnique (id: ??, ns: 14), Catégorie:Histoire


# import wikipediaapi

# wiki_wiki = wikipediaapi.Wikipedia('en')
# page_py = wiki_wiki.page('Python_(programming_language)')
# page_lune = wiki_wiki.page('Lune')
# insert_noeud(page_py)
# # insert_noeud(page_lune)
# insert_capture(page_py, 1)
# insert_arc(page_py, page_lune)
# requete = """
# SELECT *
# FROM arc
# JOIN noeud ON arc.nom_1 = noeud.nom
# JOIN capture ON capture.id_noeud = noeud.nom
# ;
# """
# curseur.execute(requete)
# a = curseur.fetchall()
# print(a)

# print(noeud_existe(page_py))
# print(noeud_existe(page_lune))




